<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Deb's Trivia Game</title>

  <!-- Added link to the jQuery Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Added a link to Bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">

  <!-- Added a link to our external stylesheet-->
  <link rel="stylesheet" href="assets/css/style.css">

</head>

<body>


  <!-- Overall Bootstrap Grid -->
  <div class="container">

    <div>
      <h1 class="text-center">
        <span class="head">World Trivia</span>
      </h1>
    </div>


    <div class="row text-center">
      <div class="col-sm-12">
        <div id="timer"> </div>
      </div>
    </div>

    <div class="row text-center">
      <div class="col-sm-12">
        <div id="question"> </div>
      </div>
    </div>

    <div class="row text-center">
      <div class="col-sm-12">
        <div id="optionsBtn"> </div>
      </div>
    </div>

    <div class="row text-center">
      <div class="col-sm-12">
        <h3 id="response"> </h3>
        <div id="responseImg"> </div>
      </div>
    </div>

    <div class="row text-center">
      <div class="col-sm-12">
        <div class="winloss">
          <h5 id="correct-text"></h5>
          <h5 id="wrong-text"></h5>
          <h5 id="unanswered-text"></h5>
        </div>
      </div>
    </div>
  </div>


  <script type="text/javascript">
    var questions = [
      {
        "question": "What day is it?",
        "options": ["Monday", "Tuesday", "Wednesday", "Thursday"],
        "answer": 3,
        "url": "assets/images/question1.png"
      },
      {
        "question": "What day was yesterday?",
        "options": ["Monday", "Tuesday", "Wednesday", "Thursday"],
        "answer": 2,
        "url": "assets/images/question2.png"
      }
    ];
    var correct = 0,
      wrong = 0,
      unanswered = 0,
      currentQuestion = 0;

    /*console.log(questions[0].question);
    console.log(questions[0].options[questions[0].answer]);
    console.log(questions[0].url);

    console.log(questions[1].question);
    console.log(questions[1].options[questions[1].answer]);
    console.log(questions[1].url);*/

    //  Set our timer variable.
    var timelimit = 10;
    var questiontime = 10;
    var pausetime = 8000;

    var intervalId;


    //  The run function sets an interval
    //  that runs the decrement function once a second.
    //  *****BUG FIX******** 
    //  Clearing the intervalId prior to setting our new intervalId will not allow multiple instances.
    function startTimer(seconds) {
      timelimit = seconds;
      clearInterval(intervalId);
      intervalId = setInterval(decrement, 1000);
    }

    //  The decrement function.
    function decrement() {
      //  Decrease number by one.
      timelimit--;
      //  Show the number in the #show-number tag.
      $("#timer").html("<h2>" + "Time Remaining: " + timelimit + "</h2>");
      // $("#timer").text("Time Remaining: " + timelimit);
      //  Once number hits zero...
      if (timelimit === 0) {
        //  ...run the stop function.
        stopTimer();
        //  Alert the user that time is up.
        $("#timer").html("<h2>" + "Times Up!" + "</h2>");
        checkAnswer(-1);
      }
    }


    //  The stop function
    function stopTimer() {

      //  Clears our intervalId
      //  We just pass the name of the interval
      //  to the clearInterval function.
      clearInterval(intervalId);
    }

    //  display the start button

    function initializeGame() {

      var startBtn = $("<button>");
      startBtn.addClass("start-button");
      startBtn.text("Start");
      $("#optionsBtn").append(startBtn);
      currentQuestion = 0;
      wrong = 0;
      correct = 0;
      unanswered = 0;
    }

    function showQuestion() {
      $("#question").text(questions[currentQuestion].question);
      $("#optionsBtn").empty();
      $("#response").empty();
      $("#responseImg").empty();
      for (var i = 0; i < questions[currentQuestion].options.length; i++) {
        //create html programmatically
        var optionBtn = $("<button>");
        optionBtn.addClass("option");
        optionBtn.attr("optionnum", i);
        optionBtn.text(questions[currentQuestion].options[i]);
        $("#optionsBtn").append(optionBtn);
      }
      startTimer(questiontime);
    }
    //just determine if the answer is correct.
    function checkAnswer(selected) {
      //console.log("answernum " + answerNum + " selected " + selected);
      stopTimer()
     /* $("#response").empty();
      $("#responseImg").empty();*/
      var response = $("<img>");
      if (questions[currentQuestion].answer === selected) {
        displayResponse("yes");
      }
      else if (selected === -1)   //timed out
      {
        displayResponse("timed out", questions[currentQuestion].options[questions[currentQuestion].answer]);
      }
      else {
        displayResponse("no", questions[currentQuestion].options[questions[currentQuestion].answer]);
      }
      //go to next question
      currentQuestion++;
      //was that the last question?
      if (currentQuestion >= questions.length) {
        setTimeout(function () {
          gameOver();
        }, 5000);
        
      }
      else {
        setTimeout(function () {
          showQuestion();
        }, 5000);
        //startTimer(questiontime);
      }
    }

    //show whether they got it right, and the image
    function displayResponse(correctAnswer, actualAnswer) {
      var response = "";
      if (correctAnswer === "yes") {
        response = "Way to go!";
        correct++;
      }
      else if (correctAnswer === "no") {
        response = "Bummer, keep trying!  Correct answer was: " + actualAnswer;
        wrong++;
      }
      //then they didn't answer in time
      else {
        response = "Need to be faster, dude!  Correct answer was: " + actualAnswer;
        unanswered++;
      }

      $("#response").text(response);
      //console.log(questions[currentQuestion].url);
      var imgURL = questions[currentQuestion].url;
      var image = $("<img>").attr("src", imgURL);
      $("#responseImg").append(image);

    }

    function gameOver() {
      //first clear out the shown data
      $("#question").text("");
      $("#response").text("");
      $("#responseImg").empty();
      $("#optionsBtn").empty();
      $("#correct-text").text("Correct Answers: " + correct);
      $("#wrong-text").text("Wrong Answers: " + wrong);
      $("#unanswered-text").text("Not Answered: " + unanswered);
      initializeGame();
    }

    initializeGame();

    //processing code
    $(document).ready(function () {

      $(".start-button").on("click", function () {
        showQuestion();    
      });

      //when answer selected, see if it is correct and display picture/message
      $("#optionsBtn").on('click', '.option', function () {
        console.log("option-click " + currentQuestion + " optionnum " + parseInt($(this).attr("optionnum")));
        checkAnswer(parseInt($(this).attr("optionnum")));
      });



    });
  </script>

  <!--script src="assets/javascript/app.js"></script-->
  </div>
</body>

</html>